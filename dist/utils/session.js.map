{"version":3,"file":"session.js","sourceRoot":"/","sources":["utils/session.ts"],"names":[],"mappings":";;;;AACA,6EAA6C;AAC7C,8CAAmD;AACnD,mCAAkC;AAClC,mCAA6B;AAE7B,MAAM,aAAa,GAAG,UAAgB,EAAE,MAAM,EAA8B;;QAC1E,OAAO,MAAM,iBAAO,CAAC,MAAM,CAAC,EAAE,MAAM,EAAE,CAAC,CAAC;IAC1C,CAAC;CAAA,CAAC;AAEF,SAAsB,gBAAgB,CAAC,EAAE,MAAM,EAA8B;;QAC3E,MAAM,OAAO,GAAG,aAAa,CAAC,EAAE,MAAM,EAAE,CAAC,CAAC;QAE1C,MAAM,OAAO,GAAG,EAAE,OAAO,EAAE,CAAC,MAAM,OAAO,CAAC,CAAC,GAAG,EAAE,CAAC;QACjD,MAAM,YAAY,GAAG,IAAA,eAAO,EAAC,OAAO,EAAE;YACpC,SAAS,EAAE,IAAI;YACf,SAAS,EAAE,OAAO;SACnB,CAAC,CAAC;QAEH,OAAO,YAAY,CAAC;IACtB,CAAC;CAAA;AAVD,4CAUC;AAED,SAAsB,eAAe,CAAC,IAAS;;QAC7C,MAAM,OAAO,GAAG,IAAA,aAAI,EAAC,IAAI,CAAC,MAAM,EAAE,EAAE,mBAAY,CAAC,CAAC;QAElD,MAAM,WAAW,GAAG,IAAA,eAAO,EAAC,OAAO,EAAE;YACnC,SAAS,EAAE,IAAI;SAChB,CAAC,CAAC;QAEH,OAAO,WAAW,CAAC;IACrB,CAAC;CAAA;AARD,0CAQC;AAED,SAAsB,eAAe,CAAC,EAAU;;QAC9C,OAAO,iBAAO,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;IAC9B,CAAC;CAAA;AAFD,0CAEC","sourcesContent":["import { Types } from 'mongoose';\r\nimport Session from '../models/user/session';\r\nimport { privateField } from '../models/user/user';\r\nimport { signJwt } from './token';\r\nimport { omit } from 'lodash'\r\n\r\nconst createSession = async function ({ userId }: { userId: Types.ObjectId }) {\r\n  return await Session.create({ userId });\r\n};\r\n\r\nexport async function signRefreshToken({ userId }: { userId: Types.ObjectId }) {\r\n  const session = createSession({ userId });\r\n\r\n  const payload = { session: (await session)._id };\r\n  const refreshToken = signJwt(payload, {\r\n    expiresIn: '1y',\r\n    algorithm: 'RS256',\r\n  });\r\n\r\n  return refreshToken;\r\n}\r\n\r\nexport async function signAccessToken(user: any) {\r\n  const payload = omit(user.toJSON(), privateField);\r\n\r\n  const accessToken = signJwt(payload, {\r\n    expiresIn: '1d',\r\n  });\r\n\r\n  return accessToken;\r\n}\r\n\r\nexport async function findSessionById(id: string) {\r\n  return Session.findById(id);\r\n}\r\n"]}