{"version":3,"file":"index.js","sourceRoot":"/","sources":["start/index.ts"],"names":[],"mappings":"AAAA,YAAY,CAAC;;;AAGb,8DAA8B;AAE9B,wDAAwB;AACxB,6CAAmC;AACnC,sDAA6D;AAE7D,+DAA+B;AAC/B,mEAAuC;AACvC,+DAA+B;AAC/B,iEAAmC;AACnC,oDAAoD;AAGpD,SAA8B,KAAK,CAAC,MAAc;;QAChD,IAAI;YACF,yBAAyB;YACzB,MAAM,UAAU,GAAgB,EAAE,CAAC;YAEnC,oBAAoB;YACpB,UAAU,CAAC,MAAM,GAAG,MAAM,IAAA,gBAAM,EAAC,MAAM,CAAC,EAAE,CAAC,CAAA;YAC3C,UAAU,CAAC,QAAQ,GAAG,MAAM,IAAA,kBAAY,EAAC,UAAU,CAAC,CAAA;YAEpD,iBAAiB;YACjB,MAAM,GAAG,GAAG,IAAA,iBAAO,GAAE,CAAC;YACtB,GAAG,CAAC,GAAG,CAAC,iBAAO,CAAC,UAAU,CAAC,EAAE,QAAQ,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC;YAEhD,kBAAkB;YAClB,MAAM,KAAK,GAAG,IAAA,iBAAS,EAAC,UAAU,CAAC,CAAA;YACnC,MAAM,KAAK,CAAC,KAAK,EAAE,CAAA;YAEnB,qBAAqB;YACrB,GAAG,CAAC,GAAG,CAAC,cAAc,EAAE,CAAC,CAAC,EAAE,GAAG,EAAE,EAAE;gBACjC,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;YAC1C,CAAC,CAAC,CAAC;YAGH,kCAAkC;YAClC,GAAG,CAAC,GAAG,CACL,UAAU,EACV,IAAA,cAAI,GAAoB,EACxB,IAAA,kBAAI,GAAE,EACN,IAAA,4BAAiB,EAAC,KAAK,EAAE;gBACvB,OAAO,EAAE,oBAAU;aACpB,CAAC,CACH,CAAC;YAGF,GAAG,CAAC,MAAM,CAAC,MAAM,CAAC,GAAG,CAAC,IAAI,EAAE,GAAG,EAAE;gBAC/B,aAAG,CAAC,IAAI,CACN,oCAAoC,MAAM,CAAC,GAAG,CAAC,IAAI,UAAU,CAC9D,CAAC;YACJ,CAAC,CAAC,CAAC;SACJ;QAAC,OAAO,GAAG,EAAE;YACZ,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;SACpB;IACH,CAAC;CAAA;AA1CD,wBA0CC","sourcesContent":["\"use strict\";\r\n\r\nimport { Config } from \"../config\";\r\nimport express from \"express\";\r\nimport { IAppContext } from \"../types/app\";\r\nimport cors from \"cors\";\r\nimport { json } from \"body-parser\";\r\nimport { expressMiddleware } from \"@apollo/server/express4\" ;\r\n\r\nimport initDb from \"../models\";\r\nimport initServices from \"../services\";\r\nimport log from \"../utils/log\";\r\nimport initGraph from \"../graphql\";\r\nimport { setContext } from \"../middlewares/context\";\r\n\r\n\r\nexport default async function start(config: Config) {\r\n  try {\r\n    // setting global context\r\n    const appContext: IAppContext = {};\r\n\r\n    // initialize models\r\n    appContext.models = await initDb(config.db)\r\n    appContext.services = await initServices(appContext)\r\n\r\n    // initialize app\r\n    const app = express();\r\n    app.use(express.urlencoded({ extended: true }));\r\n\r\n    //initialize graph\r\n    const graph = initGraph(appContext)\r\n    await graph.start()\r\n\r\n    //server health check\r\n    app.use(\"/healthcheck\", (_, res) => {\r\n      res.status(200).send(\"All is green!!!\");\r\n    });\r\n\r\n    \r\n    //apollo server express middleware\r\n    app.use(\r\n      \"/graphql\",\r\n      cors<cors.CorsRequest>(),\r\n      json(),\r\n      expressMiddleware(graph, {\r\n        context: setContext,\r\n      })\r\n    );\r\n\r\n\r\n    app.listen(config.app.port, () => {\r\n      log.info(\r\n        `Server ready at http://localhost:${config.app.port}/graphql`\r\n      );\r\n    }); \r\n  } catch (err) {\r\n    console.error(err);\r\n  }\r\n}"]}